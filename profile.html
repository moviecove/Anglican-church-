<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Member Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#576e45;
  color:#CCD4C9;
  overflow-y:auto;
}

/* HEADER */
header{
  padding:15px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  position:sticky;
  top:0;
  z-index:2;
  border-bottom:1px solid rgba(204,212,201,0.2);
}
header .title{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:bold;
}
header img{
  width:45px;
  border-radius:50%;
}

/* PROFILE CARD */
.profile-card{
  max-width:500px;
  margin:25px auto;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  padding:25px;
  border-radius:15px;
  text-align:center;
  box-shadow:0 0 30px rgba(0,0,0,0.3);
  transition:0.3s;
}
.profile-card:hover{ box-shadow:0 0 40px rgba(170,198,75,0.5); }

/* Avatar */
#userAvatarContainer{
  width:100px;
  height:100px;
  margin:0 auto 15px;
  border-radius:50%;
  background:rgba(255,255,255,0.05);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:50px;
  color:#232d26;
  overflow:hidden;
  transition:transform 0.3s;
}
#userAvatarContainer img{ width:100%; height:100%; object-fit:cover; border-radius:50%; }
#userAvatarContainer:hover{ transform:scale(1.05); }

/* Buttons */
button{
  padding:12px 20px;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
  transition:0.3s;
  margin-top:15px;
}
#logoutBtn{
  background:#AAC64B;
  color:#232d26;
}
#logoutBtn:hover{ box-shadow:0 0 25px #4FC3F7; transform:scale(1.03); }

/* See all members */
#membersBtn{
  background:#232d26;
  color:#AAC64B;
  width:100%;
  margin-top:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#membersDropdown{
  margin-top:10px;
  max-height:0;
  overflow:hidden;
  transition:all 0.4s ease;
  border-radius:10px;
}
.member-item{
  background:#576e45;
  padding:10px 12px;
  border-bottom:1px solid rgba(204,212,201,0.2);
  text-align:left;
}
.member-item:last-child{ border-bottom:none; }

/* Smooth fade in */
.member-item.show{
  animation:fadeIn 0.4s ease forwards;
}
@keyframes fadeIn{ from{opacity:0;} to{opacity:1;} }
</style>
</head>

<body>

<header>
  <div class="title">
    <img src="logo.png" alt="Logo">
    <span>Church of the Holy Spirit Rumouke</span>
  </div>
  <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
</header>

<div class="profile-card">
  <div id="userAvatarContainer">
    <i id="userAvatarIcon" class="fas fa-user"></i>
  </div>

  <h2 id="welcomeText">Welcome!</h2>
  <p id="userEmail"></p>

  <!-- See all members dropdown -->
  <button id="membersBtn">See All Members <i class="fas fa-chevron-down"></i></button>
  <div id="membersDropdown"></div>
</div>

<script>
  // Firebase config
  firebase.initializeApp({
    apiKey: "AIzaSyBvltqTTiJzNvqCy8XhttCCQ3LL6e3IsVM",
    authDomain: "church-of-the-holy-spiri-dcdf3.firebaseapp.com",
    projectId: "church-of-the-holy-spiri-dcdf3",
    storageBucket: "church-of-the-holy-spiri-dcdf3.firebasestorage.app",
    messagingSenderId: "926358296297",
    appId: "1:926358296297:web:31439032719a21e7830278",
    measurementId: "G-FTYLC0P9GR"
  });

  const auth = firebase.auth();
  const db = firebase.firestore();

  const userAvatarContainer = document.getElementById("userAvatarContainer");
  const userAvatarIcon = document.getElementById("userAvatarIcon");
  const welcomeText = document.getElementById("welcomeText");
  const userEmailEl = document.getElementById("userEmail");

  const logoutBtn = document.getElementById("logoutBtn");
  const membersBtn = document.getElementById("membersBtn");
  const membersDropdown = document.getElementById("membersDropdown");

  // Auth check
  auth.onAuthStateChanged(user => {
    if(!user) window.location="login.html";
    else{
      userEmailEl.innerText = user.email;
      welcomeText.innerText = `Welcome, ${user.email.split("@")[0]}!`;

      if(user.photoURL){
        userAvatarContainer.innerHTML = `<img src="${user.photoURL}">`;
      }
    }
  });

  // Logout
  logoutBtn.addEventListener("click", ()=>{
    auth.signOut().then(()=>window.location="login.html");
  });

  // Toggle members dropdown
  let dropdownOpen = false;
  membersBtn.addEventListener("click", async ()=>{
    dropdownOpen = !dropdownOpen;
    if(dropdownOpen){
      membersDropdown.style.maxHeight = "400px";
      // fetch members from Firestore
      membersDropdown.innerHTML = "<p style='text-align:center;padding:10px;color:#CCD4C9;'>Loading...</p>";
      const snapshot = await db.collection("users").get();
      membersDropdown.innerHTML = "";
      snapshot.forEach(doc=>{
        const data = doc.data();
        const item = document.createElement("div");
        item.className = "member-item show";
        item.innerText = data.email || "Unknown";
        membersDropdown.appendChild(item);
      });
    } else {
      membersDropdown.style.maxHeight = "0";
    }
  });
</script>

</body>
</html>