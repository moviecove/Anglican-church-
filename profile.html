<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Member Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font Awesome -->
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Firebase v8 (compat) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

</head>

<body style="
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:#576e45;
color:#fff;
overflow-y:auto;
">

<!-- FALLING CROSSES -->
<div id="cross-container" style="
position:fixed;
inset:0;
z-index:1;
pointer-events:none;
"></div>

<!-- HEADER -->
<div style="
padding:15px;
display:flex;
align-items:center;
gap:10px;
background:rgba(255,255,255,0.05);
backdrop-filter:blur(8px);
position:relative;
z-index:2;
">
  <img src="logo.png" style="width:45px;">
  <div>
    <strong>Church of the Holy Spirit Rumouke</strong><br>
    <small style="opacity:0.7;">Member Profile</small>
  </div>
</div>

<!-- PROFILE CONTENT -->
<div style="
padding:20px;
position:relative;
z-index:2;
max-width:500px;
margin:auto;
text-align:center;
">

<!-- Avatar -->
<div id="userAvatarContainer" style="
width:100px;
height:100px;
border-radius:50%;
border:2px solid #232d26;
margin:0 auto 15px;
display:flex;
align-items:center;
justify-content:center;
background:rgba(255,255,255,0.05);
font-size:50px;
color:#232d26;
">
  <i id="userAvatarIcon" class="fas fa-user"></i>
</div>

<h2 id="welcomeText">Welcome!</h2>
<p id="userEmail"></p>

<button id="logoutBtn" style="
margin-top:20px;
padding:12px 20px;
border:none;
border-radius:8px;
background:#ccd4c9;
color:#fff;
cursor:pointer;
transition:0.3s;
font-size:16px;
">
<i class="fas fa-sign-out-alt"></i> Logout
</button>

</div>

<script>
  // ðŸ”¹ Firebase Initialization v8
  firebase.initializeApp({
    apiKey: "AIzaSyBvltqTTiJzNvqCy8XhttCCQ3LL6e3IsVM",
    authDomain: "church-of-the-holy-spiri-dcdf3.firebaseapp.com",
    projectId: "church-of-the-holy-spiri-dcdf3",
    storageBucket: "church-of-the-holy-spiri-dcdf3.firebasestorage.app",
    messagingSenderId: "926358296297",
    appId: "1:926358296297:web:31439032719a21e7830278",
    measurementId: "G-FTYLC0P9GR"
  });

  const auth = firebase.auth();
  const db = firebase.firestore(); // Optional if you want to fetch user-specific data later

  // Auth check and welcome message
  auth.onAuthStateChanged(user => {
    if(!user){
      window.location="login.html";
    } else {
      document.getElementById("userEmail").innerText = user.email;

      // Welcome message (first login vs returning)
      const lastLogin = localStorage.getItem("lastLogin_" + user.uid);
      const welcomeText = document.getElementById("welcomeText");
      if(!lastLogin){
        welcomeText.innerText = `Welcome, ${user.email.split("@")[0]}!`;
      } else {
        welcomeText.innerText = `Welcome back, ${user.email.split("@")[0]}!`;
      }
      localStorage.setItem("lastLogin_" + user.uid, new Date().toISOString());

      // Avatar
      const avatarContainer = document.getElementById("userAvatarContainer");
      const avatarIcon = document.getElementById("userAvatarIcon");

      if(user.photoURL){
        // Use user's profile photo
        avatarContainer.innerHTML = `<img src="${user.photoURL}" style="
          width:100%;
          height:100%;
          border-radius:50%;
          object-fit:cover;
        ">`;
      } else {
        // Default Font Awesome avatar remains
        avatarIcon.className = "fas fa-user";
      }
    }
  });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", ()=>{
    const btn = document.getElementById("logoutBtn");
    btn.style.boxShadow="0 0 25px #4fc3f7";
    setTimeout(()=>btn.style.boxShadow="none",300);

    auth.signOut().then(()=>window.location="login.html");
  });

  // Falling crosses
  const container=document.getElementById("cross-container");
  for(let i=0;i<45;i++){
    let c=document.createElement("div");
    c.innerHTML="âœ";
    c.style.cssText=`
      position:absolute;
      top:-10%;
      left:${Math.random()*100}%;
      font-size:${12+Math.random()*20}px;
      opacity:0.15;
      animation:fall ${5+Math.random()*5}s linear infinite;
    `;
    container.appendChild(c);
  }
</script>

<style>
@keyframes fall {
 to { transform: translateY(120vh); }
}
</style>

</body>
</html>